version: '3.8'

# macOS-specific overrides for Docker Desktop
services:
  traefik:
    volumes:
      # Use named volume instead of bind mount for better performance on macOS
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - traefik-data:/data
      - ./config/traefik:/etc/traefik/dynamic:ro
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  portainer:
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer-data:/data
    ports:
      - "9000:9000"
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M

  prometheus:
    volumes:
      - ./config/monitoring/prometheus:/etc/prometheus:ro
      - prometheus-data:/prometheus
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M

  grafana:
    volumes:
      - grafana-data:/var/lib/grafana
      - ./config/monitoring/grafana:/etc/grafana/provisioning:ro
    ports:
      - "3000:3000"
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  watchtower:
    deploy:
      resources:
        limits:
          memory: 128M
        reservations:
          memory: 64M

  nextcloud-db:
    volumes:
      - nextcloud-db-data:/var/lib/mysql
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  nextcloud:
    volumes:
      - nextcloud-data:/var/www/html
    ports:
      - "8000:80"
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M
